<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ComicStore Offical</title>
    <link rel="stylesheet" href="./asset/style/styleIndex.css" />

    <link
      href="https://fonts.googleapis.com/css?family=Montserrat"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="./asset/style/styleProductBox.css" />

    <link rel="icon" href="./asset/img/Logo.png" />
  </head>
  <body>
    <div class="WholePage">
      <div id="TaskBar">
        <a class="LogoSection"
          ><div class="Logo"><img src="./asset/img/Logo.png" /></div>
          <hr />

          <div class="LogoWatermark">JustMangaStore</div></a
        >
        <div class="ToolSection">
          <a id="Search"><i class="icon bi bi-search"></i></a>
          <a id="Cart"><i class="icon bi bi-cart"></i></a>
        </div>
      </div>
      <div><img class="IndexImage" src="./asset/img/TitleCard.png" /></div>
      <div id="TrendingPage">
        <div class="TitleHeader"><h2>Trending</h2></div>
        <div class="ProductIndexSection" id="TrendingSection"></div>
      </div>
    </div>
    <script type="module">
      import { getAuth } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc,
        getDoc,
        collection,
        getDocs,
        updateDoc,
      } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore-lite.js";
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyA4qqrJ1zZ6NkufDcBtfRrHpr_S3RkG-H4",
        authDomain: "mangastore-9268b.firebaseapp.com",
        projectId: "mangastore-9268b",
        storageBucket: "mangastore-9268b.firebasestorage.app",
        messagingSenderId: "190342870546",
        appId: "1:190342870546:web:411c9b58d14a85a47f4acb",
        measurementId: "G-JV9VN7T01V",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth();
      const db = getFirestore();
      //Get Data
      const ProductList = {};
      const querySnapshot = await getDocs(collection(db, "Manga"));
      querySnapshot.forEach((doc) => {
        ProductList[doc.id] = doc.data();
      });
      const trendingSection = document.getElementById("TrendingSection");
      trendingSection.innerHTML = "";

      Object.keys(ProductList).forEach((id) => {
        const product = ProductList[id];

        trendingSection.innerHTML += `
          <a
        ><div class="ProductBox">
          <div><img src="${product.img}" alt="" /></div>
          <div class="ProductContent">
            <div class="ProductName">
              ${product.Name}
            </div>
            <div class="">
              ${product.Author}
            </div>
            <div class="StarRating">
              ${StarRating(product.Rating)}
            </div>
            <div
              style="
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
              "
            >
              <div class="Price">${product.Price.toLocaleString()} â‚«</div>
              <span><button class="BuyButton">Buy</button></span>
            </div>
          </div>
        </div></a
      >
        `;
      });
      function StarRating(rating) {
        let starsHTML = "";
        const fullStars = Math.floor(rating);
        const hasHalfStar = rating % 1 >= 0.5;

        for (let i = 1; i <= 5; i++) {
          if (i <= fullStars) {
            starsHTML += `<span class="fa fa-star checked"></span>`;
          } else if (i === fullStars + 1 && hasHalfStar) {
            starsHTML += `<span class="fa fa-star-half-full checked"></span></span>`;
          } else {
            starsHTML += `<span class="fa fa-star-o"></span>`;
          }
        }

        return starsHTML;
      }
    </script>
  </body>
</html>
